import pickle
import telegram
from telegram.ext import Updater,MessageHandler,Filters,CommandHandler
import emoji
import os
from telegram_bot.config import api_key,chat_id
from database.stock import StockModel
from pymongo import MongoClient
import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
from io import BytesIO

with open('regression/saved_model.pickle','rb') as f:
    model3 = pickle.load(f)

client = MongoClient('localhost', 27017)
db = client['Ipo']

DIR = 'C:/Users/KHS/Desktop/대학교/데이터 청년 캠퍼스/깃허브/Prediction-of-IPO-stock-price-using-chatbot'
df = pd.read_csv(DIR+'/raw data/refined_data.csv')
    
data_pre=list(df.loc[0])
# 5 6 7 8 9
data_predict=data_pre[6:11]

x_new=np.array(data_predict).reshape(1,-1)
y_predict = int(model3.predict(x_new))
data_pre.append(y_predict)

info= {
    "기업명" :data_pre[1],
    "매출액": float(data_pre[2]),
    "순이익": float(data_pre[3]),
    "구주매출": float(data_pre[4]),
    "희망공모가최저": float(data_pre[5]),
    "희망공모가최고": float(data_pre[6]),
    "청약경쟁률": float(data_pre[7]),
    "확정공모가": float(data_pre[8]),
    "경쟁률": float(data_pre[9]),
    "의무보유확약": float(data_pre[10]),
    "공모가": int(data_pre[11]),
    "시초가": int(data_pre[12]),
    "예상시초가":int(data_pre[13]),
}

print(info)
